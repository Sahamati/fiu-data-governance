// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.

package attest

import (
	"bytes"
	"testing"

	"crypto/rand"
	"crypto/rsa"
	"encoding/base64"
	"encoding/hex"
	"fmt"

	"github.com/Microsoft/confidential-sidecar-containers/pkg/common"
	"github.com/pkg/errors"
)

func Test_SNP(t *testing.T) {

	TestSNPReport := SNPAttestationReport{
		Version:          1,
		GuestSvn:         1,
		Policy:           196639,
		FamilyID:         "01000000000000000000000000000000",
		ImageID:          "02000000000000000000000000000000",
		VMPL:             0,
		SignatureAlgo:    1,
		PlatformVersion:  3530822107858468864,
		PlatformInfo:     1,
		AuthorKeyEn:      0,
		Reserved1:        0,
		ReportData:       "7ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000",
		Measurement:      "b579c7d6b89f3914659abe09a004a58a1e77846b65bbdac9e29bd8f2f31b31af445a5dd40f76f71ecdd73117f1d592a3",
		HostData:         "8c19f1b6eee8658fbf8ff1b37f603c38929896b1cc813583bbfb21015b7aa66d",
		IDKeyDigest:      "d188ac79386022aec7aa4e72a7e87b0a8e0e8009183334bb0fe4f97ed89436f360b3644cd8382c7a14531a87b81a8f36",
		AuthorKeyDigest:  "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		ReportID:         "2e880add9a31077e5e8f3568b4c4451f0fea4372f66e3df3c0ca3ba26f447db2",
		ReportIDMA:       "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
		ReportedTCB:      3530822107858468864,
		Reserved2:        "000000000000000000000000000000000000000000000000",
		ChipID:           "e6c86796cd44b0bc6b7c0d4fdab33e2807e14b5fc4538b3750921169d97bcf4447c7d3ab2a7c25f74c1641e2885c1011d025cc536f5c9a2504713136c7877f48",
		CommittedSvn:     0,
		CommittedVersion: 0,
		LaunchSvn:        0,
		Reserved3:        "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
		Signature:        "247c7525e84623db9868fccf00faab22229d60aaa380213108f8875011a8f456231c5371277cc706733f4a483338fb59000000000000000000000000000000000000000000000000ed8c62254022f64630ebf97d66254dee04f708ecbe22387baf8018752fadc2b763f64bded65c94a325b6b9f22ebbb0d80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
	}

	TestSNPReportBytes, _ := hex.DecodeString("01000000010000001f00030000000000010000000000000000000000000000000200000000000000000000000000000000000000010000000000000000000031010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000b579c7d6b89f3914659abe09a004a58a1e77846b65bbdac9e29bd8f2f31b31af445a5dd40f76f71ecdd73117f1d592a38c19f1b6eee8658fbf8ff1b37f603c38929896b1cc813583bbfb21015b7aa66dd188ac79386022aec7aa4e72a7e87b0a8e0e8009183334bb0fe4f97ed89436f360b3644cd8382c7a14531a87b81a8f360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e880add9a31077e5e8f3568b4c4451f0fea4372f66e3df3c0ca3ba26f447db2ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000031000000000000000000000000000000000000000000000000e6c86796cd44b0bc6b7c0d4fdab33e2807e14b5fc4538b3750921169d97bcf4447c7d3ab2a7c25f74c1641e2885c1011d025cc536f5c9a2504713136c7877f48000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000247c7525e84623db9868fccf00faab22229d60aaa380213108f8875011a8f456231c5371277cc706733f4a483338fb59000000000000000000000000000000000000000000000000ed8c62254022f64630ebf97d66254dee04f708ecbe22387baf8018752fadc2b763f64bded65c94a325b6b9f22ebbb0d80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")

	type testcase struct {
		name string

		SNPReport      *SNPAttestationReport
		SNPReportBytes []byte

		expectedContent interface{}
		expectedError   error
		expectErr       bool
	}

	testcases := []*testcase{
		// SerializeReport_Success passes the testing if the error returned is nil and the returned content matches the expected one
		{
			name: "SerializeReport_Success",

			SNPReport:      &TestSNPReport,
			SNPReportBytes: nil,

			expectedContent: TestSNPReportBytes,

			expectedError: nil,
			expectErr:     false,
		},
		// DeseerializeReport_Succes passes the testing if it does not receive error and the returned content matches the expected one
		{
			name: "DeserializeReport_Success",

			SNPReport:      nil,
			SNPReportBytes: TestSNPReportBytes,

			expectedContent: TestSNPReport,

			expectedError: nil,
			expectErr:     false,
		},
		// DeserializeReport_InvalidSize passes the testing if it receives the expected error
		{
			name: "DeserializeReport_InvalidSize",

			SNPReport:      nil,
			SNPReportBytes: make([]byte, 4),

			expectedError: errors.Errorf("invalid snp report size"),
			expectErr:     true,
		},
	}

	for _, tc := range testcases {
		t.Run(tc.name, func(t *testing.T) {

			if tc.SNPReportBytes == nil {
				// this is a Serialize Test
				mySNPReportBytes, err := tc.SNPReport.SerializeReport()

				if tc.expectErr {
					if err == nil {
						t.Fatal("expected err but got nil")
					} else if err.Error() != tc.expectedError.Error() {
						t.Fatalf("expected %q got %q", tc.expectedError.Error(), err.Error())
					}
				} else {
					if err != nil {
						t.Fatalf("did not expect err got %q", err.Error())
					} else if !bytes.Equal(tc.expectedContent.([]byte), mySNPReportBytes) {
						t.Fatalf("expected %q got %q", tc.expectedContent.([]byte), tc.SNPReportBytes)
					}
				}

			} else {
				// this is a Deserialize Test
				var mySNPReport SNPAttestationReport
				err := mySNPReport.DeserializeReport(tc.SNPReportBytes)

				if tc.expectErr {
					if err == nil {
						t.Fatal("expected err but got nil")
					} else if err.Error() != tc.expectedError.Error() {
						t.Fatalf("expected %q got %q", tc.expectedError.Error(), err.Error())
					}
				} else {
					if err != nil {
						t.Fatalf("did not expect err got %q", err.Error())
					} else if tc.expectedContent.(SNPAttestationReport) != mySNPReport {
						t.Fatalf("expected %v got %v", tc.expectedContent.(SNPAttestationReport), mySNPReport)
					}
				}
			}
		})
	}
}

func Test_CertCache(t *testing.T) {
	TestSNPReportBytes, _ := hex.DecodeString("01000000010000001f00030000000000010000000000000000000000000000000200000000000000000000000000000000000000010000000000000000000031010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000b579c7d6b89f3914659abe09a004a58a1e77846b65bbdac9e29bd8f2f31b31af445a5dd40f76f71ecdd73117f1d592a38c19f1b6eee8658fbf8ff1b37f603c38929896b1cc813583bbfb21015b7aa66dd188ac79386022aec7aa4e72a7e87b0a8e0e8009183334bb0fe4f97ed89436f360b3644cd8382c7a14531a87b81a8f360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e880add9a31077e5e8f3568b4c4451f0fea4372f66e3df3c0ca3ba26f447db2ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000031000000000000000000000000000000000000000000000000e6c86796cd44b0bc6b7c0d4fdab33e2807e14b5fc4538b3750921169d97bcf4447c7d3ab2a7c25f74c1641e2885c1011d025cc536f5c9a2504713136c7877f48000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000247c7525e84623db9868fccf00faab22229d60aaa380213108f8875011a8f456231c5371277cc706733f4a483338fb59000000000000000000000000000000000000000000000000ed8c62254022f64630ebf97d66254dee04f708ecbe22387baf8018752fadc2b763f64bded65c94a325b6b9f22ebbb0d80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
	var TestSNPReport SNPAttestationReport
	if err := TestSNPReport.DeserializeReport(TestSNPReportBytes); err != nil {
		t.Fatalf("failed to deserialize attestation report")
	}

	ValidEndpoint := "americas.test.acccache.azure.net"
	ValidTEEType := "SevSnpVM"
	ValidAPIVersion := "api-version=2020-10-15-preview"
	ValidChipID := TestSNPReport.ChipID
	ValidPlatformVersion := TestSNPReport.PlatformVersion

	type testcase struct {
		name string

		certCache CertCache

		chipID          string
		platformVersion uint64

		expectedError   error
		expectErr       bool
		expectedContent string
	}

	testcases := []*testcase{
		// CertCache_Success passes the testing if it does not receive an error and the certchain mathces the expected content
		{
			name: "CertCache_Success",
			certCache: CertCache{
				Endpoint:   ValidEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidAPIVersion,
			},
			chipID:          ValidChipID,
			platformVersion: ValidPlatformVersion,
			expectedError:   nil,
			expectErr:       false,
			expectedContent: "-----BEGIN CERTIFICATE-----\nMIIFTDCCAvugAwIBAgIBADBGBgkqhkiG9w0BAQowOaAPMA0GCWCGSAFlAwQCAgUA\noRwwGgYJKoZIhvcNAQEIMA0GCWCGSAFlAwQCAgUAogMCATCjAwIBATB7MRQwEgYD\nVQQLDAtFbmdpbmVlcmluZzELMAkGA1UEBhMCVVMxFDASBgNVBAcMC1NhbnRhIENs\nYXJhMQswCQYDVQQIDAJDQTEfMB0GA1UECgwWQWR2YW5jZWQgTWljcm8gRGV2aWNl\nczESMBAGA1UEAwwJU0VWLU1pbGFuMB4XDTIyMDIwOTIxMDYwMFoXDTI5MDIwOTIx\nMDYwMFowejEUMBIGA1UECwwLRW5naW5lZXJpbmcxCzAJBgNVBAYTAlVTMRQwEgYD\nVQQHDAtTYW50YSBDbGFyYTELMAkGA1UECAwCQ0ExHzAdBgNVBAoMFkFkdmFuY2Vk\nIE1pY3JvIERldmljZXMxETAPBgNVBAMMCFNFVi1WQ0VLMHYwEAYHKoZIzj0CAQYF\nK4EEACIDYgAEv8TQmmW1BdCCyeVpj9C6Y2IW3rv3swTxZJNHBYGd9hRvWAyan82O\nCrX4tPiRzxmFRzY7e1RcGWYDhgQw2p8UokXGVz9fKNJKqBMdvEQf7vGUocRHhM83\nJTJrxmq0QxBXo4IBFjCCARIwEAYJKwYBBAGceAEBBAMCAQAwFwYJKwYBBAGceAEC\nBAoWCE1pbGFuLUEwMBEGCisGAQQBnHgBAwEEAwIBADARBgorBgEEAZx4AQMCBAMC\nAQAwEQYKKwYBBAGceAEDBAQDAgEAMBEGCisGAQQBnHgBAwUEAwIBADARBgorBgEE\nAZx4AQMGBAMCAQAwEQYKKwYBBAGceAEDBwQDAgEAMBEGCisGAQQBnHgBAwMEAwIB\nADARBgorBgEEAZx4AQMIBAMCATEwTQYJKwYBBAGceAEEBEDmyGeWzUSwvGt8DU/a\nsz4oB+FLX8RTizdQkhFp2XvPREfH06sqfCX3TBZB4ohcEBHQJcxTb1yaJQRxMTbH\nh39IMEYGCSqGSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAICBQChHDAaBgkqhkiG9w0B\nAQgwDQYJYIZIAWUDBAICBQCiAwIBMKMDAgEBA4ICAQBbwYA2balTK5o3cPAQarZT\ngIRuX4nXWJDHpDJ2YikPK2Te48O49i9r5+1Voza/JauOI+u8h3Rg3fZSCbemLutw\nDzp6vRv9LJOKhy20HcBl2xYKL1zDX2MTnxg2PrHEE++PeMVf4nbhZkbnyfOXE9Ui\nkatdAdpjpSVhIe78c+IipM1rI1weCdRckmPidZHrJvIARYDyUZjHWoqV28O0reaE\nGXPO7k4VyfRh9hBYhwaFyVsAc1yhdU8Fi1jVzXwnyh7xlGfoakIC1oTiv2OF8w8C\nTKir+JXWqndF3BVNK4vMpdCoXO76KELA+gCPOsbbOQ2LMo7ZlwrwrXElFONwyQdi\ncM56hZ7pdGeGe4DoVWQMR/0LJ3b53r90zrvK+2rT65TffeYkt9OUhn5EkCYEGwOI\nb0/f41VTcN2eyh3OUXhucuCsNGCkqSp4sT79W9TOwUHB2oCricjMoLo9nNmdjIWj\nrA0cAae74AbSMmrVEavEdm10zb2lvFshYp5L4reqOqs5DKM+ksKp1u/SsiELYu+i\n3SMDsP/+3eM+7MgJj05rRaGSoYm/mbTUtDl1zZTRVPaW7eQmJBrzClHTd47N+hzD\n/2rJ4hcJnQLVSyYeNxi6zWAv83B95elvyD35CFh8M0L8GjHu+iww3/i6d5rSPLEp\n94cYfdFPuj/5HEjXDN5eww==\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIGiTCCBDigAwIBAgIDAQABMEYGCSqGSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAIC\nBQChHDAaBgkqhkiG9w0BAQgwDQYJYIZIAWUDBAICBQCiAwIBMKMDAgEBMHsxFDAS\nBgNVBAsMC0VuZ2luZWVyaW5nMQswCQYDVQQGEwJVUzEUMBIGA1UEBwwLU2FudGEg\nQ2xhcmExCzAJBgNVBAgMAkNBMR8wHQYDVQQKDBZBZHZhbmNlZCBNaWNybyBEZXZp\nY2VzMRIwEAYDVQQDDAlBUkstTWlsYW4wHhcNMjAxMDIyMTgyNDIwWhcNNDUxMDIy\nMTgyNDIwWjB7MRQwEgYDVQQLDAtFbmdpbmVlcmluZzELMAkGA1UEBhMCVVMxFDAS\nBgNVBAcMC1NhbnRhIENsYXJhMQswCQYDVQQIDAJDQTEfMB0GA1UECgwWQWR2YW5j\nZWQgTWljcm8gRGV2aWNlczESMBAGA1UEAwwJU0VWLU1pbGFuMIICIjANBgkqhkiG\n9w0BAQEFAAOCAg8AMIICCgKCAgEAnU2drrNTfbhNQIllf+W2y+ROCbSzId1aKZft\n2T9zjZQOzjGccl17i1mIKWl7NTcB0VYXt3JxZSzOZjsjLNVAEN2MGj9TiedL+Qew\nKZX0JmQEuYjm+WKksLtxgdLp9E7EZNwNDqV1r0qRP5tB8OWkyQbIdLeu4aCz7j/S\nl1FkBytev9sbFGzt7cwnjzi9m7noqsk+uRVBp3+In35QPdcj8YflEmnHBNvuUDJh\nLCJMW8KOjP6++Phbs3iCitJcANEtW4qTNFoKW3CHlbcSCjTM8KsNbUx3A8ek5EVL\njZWH1pt9E3TfpR6XyfQKnY6kl5aEIPwdW3eFYaqCFPrIo9pQT6WuDSP4JCYJbZne\nKKIbZjzXkJt3NQG32EukYImBb9SCkm9+fS5LZFg9ojzubMX3+NkBoSXI7OPvnHMx\njup9mw5se6QUV7GqpCA2TNypolmuQ+cAaxV7JqHE8dl9pWf+Y3arb+9iiFCwFt4l\nAlJw5D0CTRTC1Y5YWFDBCrA/vGnmTnqG8C+jjUAS7cjjR8q4OPhyDmJRPnaC/ZG5\nuP0K0z6GoO/3uen9wqshCuHegLTpOeHEJRKrQFr4PVIwVOB0+ebO5FgoyOw43nyF\nD5UKBDxEB4BKo/0uAiKHLRvvgLbORbU8KARIs1EoqEjmF8UtrmQWV2hUjwzqwvHF\nei8rPxMCAwEAAaOBozCBoDAdBgNVHQ4EFgQUO8ZuGCrD/T1iZEib47dHLLT8v/gw\nHwYDVR0jBBgwFoAUhawa0UP3yKxV1MUdQUir1XhK1FMwEgYDVR0TAQH/BAgwBgEB\n/wIBADAOBgNVHQ8BAf8EBAMCAQQwOgYDVR0fBDMwMTAvoC2gK4YpaHR0cHM6Ly9r\nZHNpbnRmLmFtZC5jb20vdmNlay92MS9NaWxhbi9jcmwwRgYJKoZIhvcNAQEKMDmg\nDzANBglghkgBZQMEAgIFAKEcMBoGCSqGSIb3DQEBCDANBglghkgBZQMEAgIFAKID\nAgEwowMCAQEDggIBAIgeUQScAf3lDYqgWU1VtlDbmIN8S2dC5kmQzsZ/HtAjQnLE\nPI1jh3gJbLxL6gf3K8jxctzOWnkYcbdfMOOr28KT35IaAR20rekKRFptTHhe+DFr\n3AFzZLDD7cWK29/GpPitPJDKCvI7A4Ug06rk7J0zBe1fz/qe4i2/F12rvfwCGYhc\nRxPy7QF3q8fR6GCJdB1UQ5SlwCjFxD4uezURztIlIAjMkt7DFvKRh+2zK+5plVGG\nFsjDJtMz2ud9y0pvOE4j3dH5IW9jGxaSGStqNrabnnpF236ETr1/a43b8FFKL5QN\nmt8Vr9xnXRpznqCRvqjr+kVrb6dlfuTlliXeQTMlBoRWFJORL8AcBJxGZ4K2mXft\nl1jU5TLeh5KXL9NW7a/qAOIUs2FiOhqrtzAhJRg9Ij8QkQ9Pk+cKGzw6El3T3kFr\nEg6zkxmvMuabZOsdKfRkWfhH2ZKcTlDfmH1H0zq0Q2bG3uvaVdiCtFY1LlWyB38J\nS2fNsR/Py6t5brEJCFNvzaDky6KeC4ion/cVgUai7zzS3bGQWzKDKU35SqNU2WkP\nI8xCZ00WtIiKKFnXWUQxvlKmmgZBIYPe01zD0N8atFxmWiSnfJl690B9rJpNR/fI\najxCW3Seiws6r1Zm+tCuVbMiNtpS9ThjNX4uve5thyfE2DgoxRFvY1CsoF5M\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIGYzCCBBKgAwIBAgIDAQAAMEYGCSqGSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAIC\nBQChHDAaBgkqhkiG9w0BAQgwDQYJYIZIAWUDBAICBQCiAwIBMKMDAgEBMHsxFDAS\nBgNVBAsMC0VuZ2luZWVyaW5nMQswCQYDVQQGEwJVUzEUMBIGA1UEBwwLU2FudGEg\nQ2xhcmExCzAJBgNVBAgMAkNBMR8wHQYDVQQKDBZBZHZhbmNlZCBNaWNybyBEZXZp\nY2VzMRIwEAYDVQQDDAlBUkstTWlsYW4wHhcNMjAxMDIyMTcyMzA1WhcNNDUxMDIy\nMTcyMzA1WjB7MRQwEgYDVQQLDAtFbmdpbmVlcmluZzELMAkGA1UEBhMCVVMxFDAS\nBgNVBAcMC1NhbnRhIENsYXJhMQswCQYDVQQIDAJDQTEfMB0GA1UECgwWQWR2YW5j\nZWQgTWljcm8gRGV2aWNlczESMBAGA1UEAwwJQVJLLU1pbGFuMIICIjANBgkqhkiG\n9w0BAQEFAAOCAg8AMIICCgKCAgEA0Ld52RJOdeiJlqK2JdsVmD7FktuotWwX1fNg\nW41XY9Xz1HEhSUmhLz9Cu9DHRlvgJSNxbeYYsnJfvyjx1MfU0V5tkKiU1EesNFta\n1kTA0szNisdYc9isqk7mXT5+KfGRbfc4V/9zRIcE8jlHN61S1ju8X93+6dxDUrG2\nSzxqJ4BhqyYmUDruPXJSX4vUc01P7j98MpqOS95rORdGHeI52Naz5m2B+O+vjsC0\n60d37jY9LFeuOP4Meri8qgfi2S5kKqg/aF6aPtuAZQVR7u3KFYXP59XmJgtcog05\ngmI0T/OitLhuzVvpZcLph0odh/1IPXqx3+MnjD97A7fXpqGd/y8KxX7jksTEzAOg\nbKAeam3lm+3yKIcTYMlsRMXPcjNbIvmsBykD//xSniusuHBkgnlENEWx1UcbQQrs\n+gVDkuVPhsnzIRNgYvM48Y+7LGiJYnrmE8xcrexekBxrva2V9TJQqnN3Q53kt5vi\nQi3+gCfmkwC0F0tirIZbLkXPrPwzZ0M9eNxhIySb2npJfgnqz55I0u33wh4r0ZNQ\neTGfw03MBUtyuzGesGkcw+loqMaq1qR4tjGbPYxCvpCq7+OgpCCoMNit2uLo9M18\nfHz10lOMT8nWAUvRZFzteXCm+7PHdYPlmQwUw3LvenJ/ILXoQPHfbkH0CyPfhl1j\nWhJFZasCAwEAAaN+MHwwDgYDVR0PAQH/BAQDAgEGMB0GA1UdDgQWBBSFrBrRQ/fI\nrFXUxR1BSKvVeErUUzAPBgNVHRMBAf8EBTADAQH/MDoGA1UdHwQzMDEwL6AtoCuG\nKWh0dHBzOi8va2RzaW50Zi5hbWQuY29tL3ZjZWsvdjEvTWlsYW4vY3JsMEYGCSqG\nSIb3DQEBCjA5oA8wDQYJYIZIAWUDBAICBQChHDAaBgkqhkiG9w0BAQgwDQYJYIZI\nAWUDBAICBQCiAwIBMKMDAgEBA4ICAQC6m0kDp6zv4Ojfgy+zleehsx6ol0ocgVel\nETobpx+EuCsqVFRPK1jZ1sp/lyd9+0fQ0r66n7kagRk4Ca39g66WGTJMeJdqYriw\nSTjjDCKVPSesWXYPVAyDhmP5n2v+BYipZWhpvqpaiO+EGK5IBP+578QeW/sSokrK\ndHaLAxG2LhZxj9aF73fqC7OAJZ5aPonw4RE299FVarh1Tx2eT3wSgkDgutCTB1Yq\nzT5DuwvAe+co2CIVIzMDamYuSFjPN0BCgojl7V+bTou7dMsqIu/TW/rPCX9/EUcp\nKGKqPQ3P+N9r1hjEFY1plBg93t53OOo49GNI+V1zvXPLI6xIFVsh+mto2RtgEX/e\npmMKTNN6psW88qg7c1hTWtN6MbRuQ0vm+O+/2tKBF2h8THb94OvvHHoFDpbCELlq\nHnIYhxy0YKXGyaW1NjfULxrrmxVW4wcn5E8GddmvNa6yYm8scJagEi13mhGu4Jqh\n3QU3sf8iUSUr09xQDwHtOQUVIqx4maBZPBtSMf+qUDtjXSSq8lfWcd8bLr9mdsUn\nJZJ0+tuPMKmBnSH860llKk+VpVQsgqbzDIvOLvD6W1Umq25boxCYJ+TuBoa4s+HH\nCViAvgT9kf/rBq1d+ivj6skkHxuzcxbk1xv6ZGxrteJxVH7KlX7YRdZ6eARKwLe4\nAFZEAwoKCQ==\n-----END CERTIFICATE-----\n",
		},
		// CertCache_Invalid_PlatformVersion passes if the uri associated with the requested certificate was not found
		{
			name: "CertCache_Invalid_PlatformVersion",
			certCache: CertCache{
				Endpoint:   ValidEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidAPIVersion,
			},
			chipID:          ValidChipID,
			platformVersion: 0xdeadbeef,
			expectedError:   errors.Errorf("http response status equal to 404 Not Found"),
			expectErr:       true,
		},
		// CertCache_Invalid_ChipID passes if the uri associated with the requested certificate was not found
		{
			name: "CertCache_Invalid_ChipID",
			certCache: CertCache{
				Endpoint:   ValidEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidAPIVersion,
			},
			chipID:          "0xdeadbeef",
			platformVersion: ValidPlatformVersion,
			expectedError:   errors.Errorf("http response status equal to 404 Not Found"),
			expectErr:       true,
		},
		// CertCache_Invalid_TEEType passes if the uri associated with the requested tee_type and certificate was not found
		{
			name: "CertCache_Invalid_TEEType",
			certCache: CertCache{
				Endpoint:   ValidEndpoint,
				TEEType:    "InvalidTEEType",
				APIVersion: ValidAPIVersion,
			},
			chipID:          ValidChipID,
			platformVersion: ValidPlatformVersion,
			expectedError:   errors.Errorf("http response status equal to 404 Not Found"),
			expectErr:       true,
		},
	}

	for _, tc := range testcases {
		t.Run(tc.name, func(t *testing.T) {
			certchain, err := tc.certCache.retrieveCertChain(tc.chipID, tc.platformVersion)

			if tc.expectErr {
				if err == nil {
					t.Fatal("expected err got nil")
				}
				if err.Error() != tc.expectedError.Error() {
					t.Fatalf("expected %q got %q", tc.expectedError.Error(), err.Error())
				}
			} else {
				if err != nil {
					t.Fatalf("did not expect err got %q", err.Error())
				}
				if string(certchain) != tc.expectedContent {
					t.Fatalf("expected %q got %q", tc.expectedContent, certchain)
				}
			}
		})
	}
}

func Test_MAA(t *testing.T) {
	TestKeyBlobBytes, err := common.GenerateJWKSetFromPEM("-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAv965SRmyp8zbG5eNFuDCmmiSeaHpujG2bC/keLSuzvDMLO1W\nyrUJveaa5bzMoO0pA46pXkmbqHisozVzpiNDLCo6d3z4TrGMeFPf2APIMu+RSrzN\n56qvHVyIr5caWfHWk+FMRDwAefyNYRHkdYYkgmFK44hhUdtlCAKEv5UQpFZjvh4i\nI9jVBdGYMyBaKQLhjI5WIh+QG6Za5sSuOCFMnmuyuvN5DflpLFz595Ss+EoBIY+N\nil6lCtvcGgR+IbjUYHAOs5ajamTzgeO8kx3VCE9HcyKmyUZsiyiF6IDRp2Bpy3NH\nTjIz7tmkpTHx7tHnRtlfE2FUv0B6i/QYl/ZA5QIDAQABAoIBAG9Ig9jFIdy3MWII\nfVmGlPgvrL0FTuWiTbbj9DSaP0VhXlq0cYFyjSrqZG7ZGSpBQ2d/x/Ya5UBKdX7X\n0rLKgvxLpcuF3RLvYZSsuQi18NiyIGfjp901Hwn9kH2fOzZt0NHGe5Cb6H7YHzvs\nv7/2RJimS2Q6xo9Om4OQymO/1n4pZ+ZMiTy56AvIYZ/ToD8lorlzkGFNQsljmTSC\nIHEqRuyttI0Tf64jNaD8K74EThlZG8AE/yNG2FiRtN37+gAgMhxNWoF64s+9D/G0\n1xL96WNP5GmxXidK4BAUwWZmLJTtgUDcGjJbmfSuEMFjpRA9wfcL717jDzB0AImO\nOnZSgWECgYEA2swHf+pU8D1vshCBCTx/wGeIMRJE1Nw3YBhvPrUCExMo8M2UAkzs\nlKq61xSnh0X7f/Ma28vj9/gT+AHOnoCSdFSFO3dxX8B3y+B3jVvbxx7P+iZrM8J+\nVgrqPaXrIpBNPCooieD6O9EGvyC0+somgvtkA3ne2jdxX1rbPaQZr5kCgYEA4H6Y\ndWb2F5Dglhby9oXfjaLslIumoTTRFTgygIXHBG0auwMQzwfhuLyzH55mBICn16Ez\nLRyqssna5NgfTF0XrZT/BIPo8dSj0hlWvDtvCnZbDMTLYrk+GdypJD2oWmsbB6gB\nFjdjU4pv8c/4WjGuuWJ8Vs47+HTBNJlJlr6fWy0CgYBapPJqdRtxWBKBM8Mxn2XR\nwVKz+byYbw9l+VmFIhpU6rgoYxLxjQrqYHz9hCoPqdeS35V9/89XOOiU87K1CdEi\n7q0vwMEwiR1YUotU/fxkVwiUuvvouqf6X5VBqw5qCFxnE5Qt4w3oYCWqYxN3Xu5r\nj1iU9BV2VEfc2FhCBk056QKBgQDChm/tKy6K9QrmgzQ80XwI6ug9P1U/0thpnqyE\nGWd+OlwzOFDUVGwO+9PqzgJwXFsTyabirDhte+Ok8HEOZowh6T2g1/x9sFfTsgkq\nSgXJ9wymX9As138sQbx+nr7GupBNbhKjAZObzBV8X01AOlTAZsp/HW1xuRnBTiIp\n8Tt8cQKBgQDUv6Jpe1/kO0YJ6KlqVcMIZa+aQFamoMavlCNxxBvjoPnVdWB9PtWi\narzVMyAVvTjnT1QvGPJj1dffE+GSrAf3mssdp/tGfMGcgSB0DRcE1jz/JlzEc81F\no9Ki1lCw8ljoaNfJ8K+7wdiQ1V/H+rgL691P/2ZGc4vdOXJvy/hGZA==\n-----END RSA PRIVATE KEY-----")
	if err != nil {
		t.Fatal("generating key blob failed")
	}

	TestSNPPolicyBlobBytes, err := base64.StdEncoding.DecodeString("eyJjb250YWluZXJzIjpbeyJjb21tYW5kIjoiL3BhdXNlIiwibGF5ZXJzIjpbIjE2YjUxNDA1N2EwNmFkNjY1ZjkyYzAyODYzYWNhMDc0ZmQ1OTc2Yzc1NWQyNmJmZjE2MzY1Mjk5MTY5ZTg0MTUiXX0seyJjb21tYW5kIjoic2ggL291ci1zY3JpcHQuc2giLCJsYXllcnMiOlsiYzExNjRiMGU0MDdjZDFmZWYyOTdmNmEzMmU5NTRmZWE3MGNjOGM3NTkwMTVhYTFjOGQ5M2UwNGY3NDkxYzA1MiIsIjdhMTc0ZmIzNDhhOGM1MTE3MGFmMWEzNmJiZWExMjJkMGFmMTYyYTViOTc3NzVlNWNmNGE0MjQ4NjIzYTA4NjQiXX1dfQ==")
	if err != nil {
		t.Fatal("decoding policy base64 failed")
	}

	// generate a different rsa key pair
	privateWrappingKey, err := rsa.GenerateKey(rand.Reader, 2048)
	if err != nil {
		t.Fatal("tampered rsa key pair generation failed")
	}

	TestKeyBlobBytesTampered, err := common.GenerateJWKSet(privateWrappingKey)
	if err != nil {
		t.Fatal("generating tampered key blob failed")
	}

	// Use a non-matching policy
	TestSNPPolicyBlobBytesTampered, err := base64.StdEncoding.DecodeString("ewoJImFsbG93X2FsbCI6IGZhbHNlLAoJImNvbnRhaW5lcnMiOiB7CgkJIm51bSI6IDIsCgkJInBhdXNlIjogewoJCQkiY29tbWFuZCI6ICIvcGF1c2UiLAoJCQkibGF5ZXJzIjogewoJCQkJIm51bSI6IDEsCgkJCQkibDAiOiAiMTZiNTE0MDU3YTA2YWQ2NjVmOTJjMDI4NjNhY2EwNzRmZDU5NzZjNzU1ZDI2YmZmMTYzNjUyOTkxNjllODQxNSIKCQkJfQoJCX0sCgkJImMwIjogewoJCQkiY29tbWFuZCI6ICJydXN0YyAtLWhlbHAiLAoJCQkibGF5ZXJzIjogewoJCQkJIm51bSI6IDYsCgkJCQkibDAiOiAiZmU4NGM5ZDViZmRkZDA3YTI2MjRkMDAzMzNjZjEzYzFhOWM5NDFmM2EyNjFmMTNlYWQ0NGZjNmE5M2JjMGU3YSIsCgkJCQkibDEiOiAiNGRlZGFlNDI4NDdjNzA0ZGE4OTFhMjhjMjVkMzIyMDFhMWFlNDQwYmNlMmFlY2NjZmE4ZTZmMDNiOTdhNmE2YyIsCgkJCQkibDIiOiAiNDFkNjRjZGViMzQ3YmYyMzZiNGMxM2I3NDAzYjYzM2ZmMTFmMWNmOTRkYmM3Y2Y4ODFhNDRkNmRhODhjNTE1NiIsCgkJCQkibDMiOiAiZWIzNjkyMWUxZjgyYWY0NmRmZTI0OGVmOGYxYjNhZmI2YTUyMzBhNjQxODFkOTYwZDEwMjM3YTA4Y2Q3M2M3OSIsCgkJCQkibDQiOiAiZTc2OWQ3NDg3Y2MzMTRkM2VlNzQ4YTQ0NDA4MDUzMTdjMTkyNjJjN2FjZDJmZGJkYjBkNDdkMmU0NjEzYTE1YyIsCgkJCQkibDUiOiAiMWI4MGYxMjBkYmQ4OGU0MzU1ZDYyNDFiNTE5YzNlMjUyOTAyMTVjNDY5NTE2YjQ5ZGVjZTljZjA3MTc1YTc2NiIKCQkJfQoJCX0KCX0sCgkic2VydmljZXMiOiB7CgkJImNlcnRjYWNoZSI6IHsKCQkJImVuZHBvaW50IjogImFtZXJpY2FzLnRlc3QuYWNjY2FjaGUuYXp1cmUubmV0IiwKCQkJInRlZV90eXBlIjogIlNldlNucFZNIiwKCQkJImFwaV92ZXJzaW9uIjogImFwaS12ZXJzaW9uPTIwMjAtMTAtMTUtcHJldmlldyIKCQl9LAoJCSJtYWEiOiB7IAoJCQkiZW5kcG9pbnQiOiAic2hhcmVkbmV1Lm5ldS5hdHRlc3QuYXp1cmUubmV0IiwKCQkJInRlZV90eXBlIjogIlNldlNucFZNIiwKCQkJImFwaV92ZXJzaW9uIjogImFwaS12ZXJzaW9uPTIwMjAtMTAtMDEiCgkJfSwgCgkJIm1oc20iOiBbIHsgCQoJCQkiZW5kcG9pbnQiOiAic3ZvbG9zLWhzbS5tYW5hZ2VkaHNtLmF6dXJlLm5ldCIsCgkJCSJhcGlfdmVyc2lvbiI6ICJhcGktdmVyc2lvbj03LjMtcHJldmlldyIsCgkJCSJraWQiOiBbCgkJCQkiTXlSdXN0Y0tleSIKCQkJXQoJCX0gXQkKCX0KfQ==")
	if err != nil {
		t.Fatal("decoding tampered policy base64 failed")
	}

	TestSNPReportBytes, _ := hex.DecodeString("01000000010000001f00030000000000010000000000000000000000000000000200000000000000000000000000000000000000010000000000000000000031010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000b579c7d6b89f3914659abe09a004a58a1e77846b65bbdac9e29bd8f2f31b31af445a5dd40f76f71ecdd73117f1d592a38c19f1b6eee8658fbf8ff1b37f603c38929896b1cc813583bbfb21015b7aa66dd188ac79386022aec7aa4e72a7e87b0a8e0e8009183334bb0fe4f97ed89436f360b3644cd8382c7a14531a87b81a8f360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e880add9a31077e5e8f3568b4c4451f0fea4372f66e3df3c0ca3ba26f447db2ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000031000000000000000000000000000000000000000000000000e6c86796cd44b0bc6b7c0d4fdab33e2807e14b5fc4538b3750921169d97bcf4447c7d3ab2a7c25f74c1641e2885c1011d025cc536f5c9a2504713136c7877f48000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000247c7525e84623db9868fccf00faab22229d60aaa380213108f8875011a8f456231c5371277cc706733f4a483338fb59000000000000000000000000000000000000000000000000ed8c62254022f64630ebf97d66254dee04f708ecbe22387baf8018752fadc2b763f64bded65c94a325b6b9f22ebbb0d80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
	var TestSNPReport SNPAttestationReport
	if err := TestSNPReport.DeserializeReport(TestSNPReportBytes); err != nil {
		t.Fatalf("failed to deserialize attestation report")
	}

	ProductionTestSNPReportBytes, _ := hex.DecodeString("02000000020000001f0003000000000001000000000000000000000000000000020000000000000000000000000000000000000001000000020000000000065d010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000deac3d39f12ba5f45e4bdd7a3686134c0b7b6883381210a87d6b8015e60a6bad5b264d5c2725e6b6ef8b9e3f376160b4dff51dbeac6096960223d54e5bee6a7df6a131c109b34d8043da5874d56bb78d70eed5b3693ebb29d964f7ae295f49cb0554b4cc33ced533c7a6f9aeb4c563c68bece465756389dfa5f527bcb65c74ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e29a02183df412e5c69c3d7b0beedfc8eff96bc16c0020b1cd06d9718ae37d9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff020000000000065d0000000000000000000000000000000000000000000000005c6095e0748b55eaca503f2a020ade6a9151d6a62a292c6c7af3c935e3a3f8f401770cd189b7f666141930e3461573301a635e7fb0898de062241ea0da9a85d3020000000000065d0133010001330100020000000000065d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008961c43fca3e22bb3e4ecd99e70bc1027fe43b32cc955077528c02249de74e1ececc6bbb91a6e2899fec6c54fab5653700000000000000000000000000000000000000000000000089c9797445d305380c5595ccc2f4e61b2c1fe5596b9ed5dc842c3d0dece0bf9aab9fc0d7c34e1315d5e143bb374303a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
	var ProductionTestSNPReport SNPAttestationReport
	if err := ProductionTestSNPReport.DeserializeReport(ProductionTestSNPReportBytes); err != nil {
		t.Fatalf("failed to deserialize attestation report")
	}

	ValidMAAEndpoint := "sharedneu.neu.attest.azure.net"
	ValidTEEType := "SevSnpVM"
	ValidMAAAPIVersion := "api-version=2020-10-01"

	certCache := CertCache{
		Endpoint:   "americas.test.acccache.azure.net",
		TEEType:    "SevSnpVM",
		APIVersion: "api-version=2020-10-15-preview",
	}

	ValidCertChain, err := certCache.retrieveCertChain(TestSNPReport.ChipID, TestSNPReport.PlatformVersion)
	if err != nil {
		t.Fatalf("retrieving cert chain failed")
	}

	ProductionCertCache := CertCache{
		Endpoint:   "americas.acccache.azure.net",
		TEEType:    "SevSnpVM",
		APIVersion: "api-version=2020-10-15-preview",
	}

	ProductionValidCertChain, err := ProductionCertCache.retrieveCertChain(ProductionTestSNPReport.ChipID, ProductionTestSNPReport.PlatformVersion)
	if err != nil {
		t.Fatalf("retrieving cert chain failed")
	}

	ProductionTestKeyBlobBytes, err := base64.StdEncoding.DecodeString(
		"eyJrZXlzIjpbeyJlIjoiQVFBQiIsImtleV9vcHMiOlsiZW5jcnlwdCJdLCJraWQiOiJOdmhmdXEyY0NJT0FCOFhSNFhpOVByME5QXzlDZU16V1FHdFdfSEFMel93Iiwia3R5IjoiUlNBIiwibiI6InY5NjVTUm15cDh6Ykc1ZU5GdURDbW1pU2VhSHB1akcyYkNfa2VMU3V6dkRNTE8xV3lyVUp2ZWFhNWJ6TW9PMHBBNDZwWGttYnFIaXNvelZ6cGlORExDbzZkM3o0VHJHTWVGUGYyQVBJTXUtUlNyek41NnF2SFZ5SXI1Y2FXZkhXay1GTVJEd0FlZnlOWVJIa2RZWWtnbUZLNDRoaFVkdGxDQUtFdjVVUXBGWmp2aDRpSTlqVkJkR1lNeUJhS1FMaGpJNVdJaC1RRzZaYTVzU3VPQ0ZNbm11eXV2TjVEZmxwTEZ6NTk1U3MtRW9CSVktTmlsNmxDdHZjR2dSLUlialVZSEFPczVhamFtVHpnZU84a3gzVkNFOUhjeUtteVVac2l5aUY2SURScDJCcHkzTkhUakl6N3Rta3BUSHg3dEhuUnRsZkUyRlV2MEI2aV9RWWxfWkE1USJ9XX0=")

	if err != nil {
		t.Fatal("decoding policy base64 failed")
	}

	ProductionTestSNPPolicyBlobBytes, err := base64.StdEncoding.DecodeString(
		"ewogICJjb250YWluZXJzIjogewogICAgImVsZW1lbnRzIjogewogICAgICAiMCI6IHsKICAgICAgICAiYWxsb3dfZWxldmF0ZWQiOiBmYWxzZSwKICAgICAgICAiY29tbWFuZCI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiL3BhdXNlIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAxCiAgICAgICAgfSwKICAgICAgICAiZW52X3J1bGVzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9BUElfVkVSU0lPTj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfSEVBREVSPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiYXp1cmVjb250YWluZXJpbnN0YW5jZV9yZXN0YXJ0ZWRfYnk9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX1NFUlZFUl9USFVNQlBSSU5UPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIT1NUTkFNRT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjQiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiUEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW4iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI1IjogewogICAgICAgICAgICAgICJydWxlIjogIlRFUk09eHRlcm0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI2IjogewogICAgICAgICAgICAgICJydWxlIjogIigoP2kpRkFCUklDKV8uKz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiVChFKT9NUD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljUGFja2FnZUZpbGVOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIb3N0ZWRTZXJ2aWNlTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAxMQogICAgICAgIH0sCiAgICAgICAgImxheWVycyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiMTZiNTE0MDU3YTA2YWQ2NjVmOTJjMDI4NjNhY2EwNzRmZDU5NzZjNzU1ZDI2YmZmMTYzNjUyOTkxNjllODQxNSIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMQogICAgICAgIH0sCiAgICAgICAgIm1vdW50cyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInN5c2ZzIiwKICAgICAgICAgICAgICAidHlwZSI6ICJzeXNmcyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMvZnMvY2dyb3VwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJyZWxhdGltZSIsCiAgICAgICAgICAgICAgICAgICI0IjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogImNncm91cCIsCiAgICAgICAgICAgICAgInR5cGUiOiAiY2dyb3VwIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL2V0Yy9yZXNvbHYuY29uZiIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogInJiaW5kIiwKICAgICAgICAgICAgICAgICAgIjEiOiAicnNoYXJlZCIsCiAgICAgICAgICAgICAgICAgICIyIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInNhbmRib3g6Ly8vdG1wL2F0bGFzL3Jlc29sdmNvbmYvLisiLAogICAgICAgICAgICAgICJ0eXBlIjogImJpbmQiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgIH0sCiAgICAgICAgIndvcmtpbmdfZGlyIjogIi8iCiAgICAgIH0sCiAgICAgICIxIjogewogICAgICAgICJhbGxvd19lbGV2YXRlZCI6IGZhbHNlLAogICAgICAgICJjb21tYW5kIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICIvYmluL3NoIiwKICAgICAgICAgICAgIjEiOiAiLWMiLAogICAgICAgICAgICAiMiI6ICJ1bnRpbCAuL21zaUF0bGFzQWRhcHRlcjsgZG8gZWNobyAkPyByZXN0YXJ0aW5nOyBkb25lIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgfSwKICAgICAgICAiZW52X3J1bGVzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9BUElfVkVSU0lPTj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfSEVBREVSPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX1NlcnZpY2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX0FwcGxpY2F0aW9uTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEyIjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19Db2RlUGFja2FnZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfU2VydmljZURuc05hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxNCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBQ0lfTUlfREVGQVVMVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE1IjogewogICAgICAgICAgICAgICJydWxlIjogIlRva2VuUHJveHlJcEFkZHJlc3NFbnZLZXlOYW1lPVtDb250YWluZXJUb0hvc3RBZGRyZXNzfEZhYnJpY19Ob2RlbFBPckZRRE5dIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTYiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiQ29udGFpbmVyVG9Ib3N0QWRkcmVzcz0xNjkuMjU0LjEyOC4xIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX05vZGVsUE9yRlFETj1bXFxkXXsxLDN9LltcXGRdezEsM30uW1xcZF17MS4zfS5bXFxkXXsxLDN9IiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX05ldHdvcmtpbmdNb2RlPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTkiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiYXp1cmVjb250YWluZXJpbnN0YW5jZV9yZXN0YXJ0ZWRfYnk9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX1NFUlZFUl9USFVNQlBSSU5UPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBQ0lfTUlfQ0xJRU5UX0lEXy4rPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBQ0lfTUlfUkVTX0lEXy4rPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIT1NUTkFNRT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjYiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiVEVSTT14dGVybSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiUEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW4iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI4IjogewogICAgICAgICAgICAgICJydWxlIjogIigoP2kpRkFCUklDKV8uKz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjkiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX0lkKz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAyMAogICAgICAgIH0sCiAgICAgICAgImxheWVycyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiNjA2ZmQ2YmFmNWViMWE3MWZkMjg2YWVhMjk2NzJhMDZiZmU1NWYwMDA3ZGVkOTJlZTczMTQyYTM3NTkwZWQxOSIsCiAgICAgICAgICAgICIxIjogIjkwYWQyZjViMmM0MjVhN2M0NThmOWY1ZDIxY2YwNjRjMjE1ZjE0ZTQwNjgwMDk2OGY2NDRkMmFiMGI0ZDA0ZGYiLAogICAgICAgICAgICAiMiI6ICIxYzRiNjM2NWE3YjkzODM4N2RmZDgyMjg2MmNhNDFhZTU0OTBiNTQ5MGU0YzI2ZWI0YjVkYTk2YzY0MDk2MGNmIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgfSwKICAgICAgICAibW91bnRzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cyIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogIm5vc3VpZCIsCiAgICAgICAgICAgICAgICAgICIxIjogIm5vZXhlYyIsCiAgICAgICAgICAgICAgICAgICIyIjogIm5vZGV2IiwKICAgICAgICAgICAgICAgICAgIjMiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAic3lzZnMiLAogICAgICAgICAgICAgICJ0eXBlIjogInN5c2ZzIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMSI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cy9mcy9jZ3JvdXAiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJlbGF0aW1lIiwKICAgICAgICAgICAgICAgICAgIjQiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAiY2dyb3VwIiwKICAgICAgICAgICAgICAidHlwZSI6ICJjZ3JvdXAiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMgogICAgICAgIH0sCiAgICAgICAgIndvcmtpbmdfZGlyIjogIi9yb290LyIKICAgICAgfSwKICAgICAgIjIiOiB7CiAgICAgICAgImFsbG93X2VsZXZhdGVkIjogZmFsc2UsCiAgICAgICAgImNvbW1hbmQiOiB7CiAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICIwIjogIi9tb3VudF9henVyZV9maWxlLnNoIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAxCiAgICAgICAgfSwKICAgICAgICAiZW52X3J1bGVzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9BUElfVkVSU0lPTj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfSEVBREVSPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX0FwcGxpY2F0aW9uTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjExIjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19Db2RlUGFja2FnZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBWlVSRV9TVE9SQUdFX0FDQ09VTlRfTkFNRSs9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBWlVSRV9TVE9SQUdFX0FDQ09VTlRfRE5TX05BTUU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxNCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJBWlVSRV9TVE9SQUdFX0FDQ09VTlRfS0VZPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTUiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiQVpVUkVfRklMRV9FTkRQT0lOVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE2IjogewogICAgICAgICAgICAgICJydWxlIjogIk1PVU5UX1BPSU5UPS9tb3VudC9henVyZWZpbGUvbW50IiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiTU9VTlRfRElSX01PREU9W1xcZF17NH0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxOCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJNT1VOVF9GSUxFX01PREU9W1xcZF17NH0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJNT1VOVF9QUk9UT0NPTD0oc21ifG5mcykiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX1NFUlZFUl9USFVNQlBSSU5UPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMjAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiTU9VTlRfQUNDRVNTX01PREU9W3J3fHJvXSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjIxIjogewogICAgICAgICAgICAgICJydWxlIjogImF6dXJlY29udGFpbmVyaW5zdGFuY2VfcmVzdGFydGVkX2J5PS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIT1NUTkFNRT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjQiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiVEVSTT14dGVybSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjUiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiUEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW4iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI2IjogewogICAgICAgICAgICAgICJydWxlIjogIigoP2kpRkFCUklDKV8uKz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX0lkPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfU2VydmljZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI5IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19TZXJ2aWNlRG5zTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAyMgogICAgICAgIH0sCiAgICAgICAgImxheWVycyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiNjA2ZmQ2YmFmNWViMWE3MWZkMjg2YWVhMjk2NzJhMDZiZmU1NWYwMDA3ZGVkOTJlZTczMTQyYTM3NTkwZWQxOSIsCiAgICAgICAgICAgICIxIjogIjNhZDFhMmZmNGE0NGJjODYwYjNjZDAyN2NjODZjZTQ1YTM5OWM0Yzk5NWMzNmU5ODAwYzUzNjhjYjcyN2E3ZTEiLAogICAgICAgICAgICAiMiI6ICJiMWNmYzMwZjM3ZjA4ZTYwNjY4ZGIzZjcxNjA2OTdiMTlkMmFkNDViMTJmMDc1MTg4NTI5OTM3MzYxNmE2ZTBhIiwKICAgICAgICAgICAgIjMiOiAiZWYzNjQ4NDZjOGYxZjQzZDE0ZDJlM2U3OTE5YTA2NGIwYzgyNTUzYzA4YjM1NDIyZjVkMWYwN2MzNDM1YjQ2MiIsCiAgICAgICAgICAgICI0IjogIjU4MmZlMzliZDM1OTA5YmFmNmM0MDM2NzM0ZTIwZjc2NjM5MWJhODM3MjdmYjFkNjgzYmUwNDVmZTQ1M2I1YWYiLAogICAgICAgICAgICAiNSI6ICJhYWM5ZmI0MDQyNThjMDY5YWU4NTM4MjM2NGY1ZDJiYTFkNDA1MThjNmIxZjU2YWRlNmJjMjJmMzAyOGVhZmYwIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiA2CiAgICAgICAgfSwKICAgICAgICAibW91bnRzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cyIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogIm5vc3VpZCIsCiAgICAgICAgICAgICAgICAgICIxIjogIm5vZXhlYyIsCiAgICAgICAgICAgICAgICAgICIyIjogIm5vZGV2IiwKICAgICAgICAgICAgICAgICAgIjMiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAic3lzZnMiLAogICAgICAgICAgICAgICJ0eXBlIjogInN5c2ZzIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMSI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cy9mcy9jZ3JvdXAiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJlbGF0aW1lIiwKICAgICAgICAgICAgICAgICAgIjQiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAiY2dyb3VwIiwKICAgICAgICAgICAgICAidHlwZSI6ICJjZ3JvdXAiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJkZXN0aW5hdGlvbiI6ICIvbW91bnQvYXp1cmVmaWxlIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAicmJpbmQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJyc2hhcmVkIiwKICAgICAgICAgICAgICAgICAgIjIiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAic2FuZGJveDovLy90bXAvYXRsYXMvYXp1cmVGaWxlVm9sdW1lLy4rIiwKICAgICAgICAgICAgICAidHlwZSI6ICJiaW5kIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL2V0Yy9yZXNvbHYuY29uZiIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogInJiaW5kIiwKICAgICAgICAgICAgICAgICAgIjEiOiAicnNoYXJlZCIsCiAgICAgICAgICAgICAgICAgICIyIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInNhbmRib3g6Ly8vdG1wL2F0bGFzL3Jlc29sdmNvbmYvLisiLAogICAgICAgICAgICAgICJ0eXBlIjogImJpbmQiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogNAogICAgICAgIH0sCiAgICAgICAgIndvcmtpbmdfZGlyIjogIi8iCiAgICAgIH0sCiAgICAgICIzIjogewogICAgICAgICJhbGxvd19lbGV2YXRlZCI6IGZhbHNlLAogICAgICAgICJjb21tYW5kIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICIvYmluL2Jhc2giLAogICAgICAgICAgICAiMSI6ICIvbW91bnRfc2VjcmV0cy5zaCIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMgogICAgICAgIH0sCiAgICAgICAgImVudl9ydWxlcyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfQVBJX1ZFUlNJT049LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX0hFQURFUj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEwIjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19Db2RlUGFja2FnZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfU2VydmljZURuc05hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJTRUNSRVRTX0NPVU5UPVtcXGRdezEsMn0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJTRUNSRVRTX1BBVEg9L21vdW50L3NlY3JldHNzb3VyY2UiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxNCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJTRUNSRVRfLj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE1IjogewogICAgICAgICAgICAgICJydWxlIjogIk1PVU5UX1BPSU5UPS9tb3VudC9zZWNyZXRzL21udCIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE2IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19TZXR0aW5nUGF0aD0vbW91bnQvc2VjcmV0c3NvdXJjZSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE3IjogewogICAgICAgICAgICAgICJydWxlIjogImF6dXJlY29udGFpbmVyaW5zdGFuY2VfcmVzdGFydGVkX2J5PS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9TRVJWRVJfVEhVTUJQUklOVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjMiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSE9TVE5BTUU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI0IjogewogICAgICAgICAgICAgICJydWxlIjogIlRFUk09eHRlcm0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI1IjogewogICAgICAgICAgICAgICJydWxlIjogIlBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICIoKD9pKUZBQlJJQylfLis9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI3IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19JZD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX1NlcnZpY2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfQXBwbGljYXRpb25OYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDE4CiAgICAgICAgfSwKICAgICAgICAibGF5ZXJzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICI2MDZmZDZiYWY1ZWIxYTcxZmQyODZhZWEyOTY3MmEwNmJmZTU1ZjAwMDdkZWQ5MmVlNzMxNDJhMzc1OTBlZDE5IiwKICAgICAgICAgICAgIjEiOiAiOGExMWVjYjI5MzZjMTkzZTk4ODdmYTA1MjhiNDFlNDY2ODFlMzkxMDZmNzY3MTBmMzI3Yzg3Mzc0Y2M1M2UyNCIsCiAgICAgICAgICAgICIyIjogIjQzM2MxNmE4NGI1ZDk5NTUzYmRmNmVlMDg0MTdmNGYyZmExMjVkZjlhMTEwY2IyMTY3OGFiNmM3YjdjZmNmNzYiLAogICAgICAgICAgICAiMyI6ICI4NzJlZGE1NGMxN2M1MGZjMzZkYjA4ZWRlMWRiZTE4NTUyMzYyODZhNzliZmE0NjY5Y2YwMTRmNDkyYmIxNjc4IiwKICAgICAgICAgICAgIjQiOiAiYzAwNWVkODdjNzFiZTI0MzA5YTIyNjg0MmViZjYzNTE5NzA3MGU3ZGFhNzE0YzdlYjg4OTVmZjFkODIyMzg2MiIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogNQogICAgICAgIH0sCiAgICAgICAgIm1vdW50cyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInN5c2ZzIiwKICAgICAgICAgICAgICAidHlwZSI6ICJzeXNmcyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMvZnMvY2dyb3VwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJyZWxhdGltZSIsCiAgICAgICAgICAgICAgICAgICI0IjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogImNncm91cCIsCiAgICAgICAgICAgICAgInR5cGUiOiAiY2dyb3VwIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL21vdW50L3NlY3JldHMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJyYmluZCIsCiAgICAgICAgICAgICAgICAgICIxIjogInJzaGFyZWQiLAogICAgICAgICAgICAgICAgICAiMiI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJzYW5kYm94Oi8vL3RtcC9hdGxhcy9zZWNyZXRzVm9sdW1lLy4rIiwKICAgICAgICAgICAgICAidHlwZSI6ICJiaW5kIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL21vdW50L3NlY3JldHNzb3VyY2UiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJyYmluZCIsCiAgICAgICAgICAgICAgICAgICIxIjogInJwcml2YXRlIiwKICAgICAgICAgICAgICAgICAgIjIiOiAicm8iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAiL3J1bi9nY3MvYy8uKyIsCiAgICAgICAgICAgICAgInR5cGUiOiAiYmluZCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjQiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9ldGMvcmVzb2x2LmNvbmYiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJyYmluZCIsCiAgICAgICAgICAgICAgICAgICIxIjogInJzaGFyZWQiLAogICAgICAgICAgICAgICAgICAiMiI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJzYW5kYm94Oi8vL3RtcC9hdGxhcy9yZXNvbHZjb25mLy4rIiwKICAgICAgICAgICAgICAidHlwZSI6ICJiaW5kIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDUKICAgICAgICB9LAogICAgICAgICJ3b3JraW5nX2RpciI6ICIvIgogICAgICB9LAogICAgICAiNCI6IHsKICAgICAgICAiYWxsb3dfZWxldmF0ZWQiOiBmYWxzZSwKICAgICAgICAiY29tbWFuZCI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAidGFpbCIsCiAgICAgICAgICAgICIxIjogIi1mIiwKICAgICAgICAgICAgIjIiOiAiL2Rldi9udWxsIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgfSwKICAgICAgICAiZW52X3J1bGVzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9BUElfVkVSU0lPTj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfSEVBREVSPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX0NvZGVQYWNrYWdlTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjExIjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19TZXJ2aWNlRG5zTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEyIjogewogICAgICAgICAgICAgICJydWxlIjogIlBPUlQ9OTk5OSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEzIjogewogICAgICAgICAgICAgICJydWxlIjogImF6dXJlY29udGFpbmVyaW5zdGFuY2VfcmVzdGFydGVkX2J5PS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9TRVJWRVJfVEhVTUJQUklOVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjMiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSE9TVE5BTUU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI0IjogewogICAgICAgICAgICAgICJydWxlIjogIlRFUk09eHRlcm0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI1IjogewogICAgICAgICAgICAgICJydWxlIjogIlBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICIoKD9pKUZBQlJJQylfLis9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI3IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19JZD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX1NlcnZpY2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfQXBwbGljYXRpb25OYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDE0CiAgICAgICAgfSwKICAgICAgICAibGF5ZXJzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICI1YzVkMWFlMWFmZjVlMWYzNmQ1MzAwZGU0NjU5MmVmZTRjY2I3ODg5ZTYwYTRiODJiYmFmMDAzYzIyNDhmMmE3IiwKICAgICAgICAgICAgIjEiOiAiYjRkMzkzYWY0ZGY3ZDkwYjQyMzk5MzQ0NTEwZDk3YTg5NDliNDNkZjVhZTE5MzNkMzNmODdmOGI5MTU4MTI0OCIsCiAgICAgICAgICAgICIyIjogImI2NzQxOWMyMTJiYjUwMWMwYzE1NjY5NTcwYTIxODZhMjQ5NmMzY2FjYzY3NjQ2MWFmNWI3ODUyNjg0ZGNmNTIiLAogICAgICAgICAgICAiMyI6ICJlNGE5OTM0YTJkZWNiYTczYmY5MjYxM2U1MmQxM2IxMWJiZGQwOTMwYmM2ZDlkZGRjYWJhNjg4YzZkOWUxZTIwIiwKICAgICAgICAgICAgIjQiOiAiOWRjYTBiMTkwYzMwZTJhMTMyOTMyYzg2NDQxYmMwYjljYTUyYWIwNmNmMTFlZWQ5ODUyYmRhMDU3ZThiZDZkMSIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogNQogICAgICAgIH0sCiAgICAgICAgIm1vdW50cyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInN5c2ZzIiwKICAgICAgICAgICAgICAidHlwZSI6ICJzeXNmcyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMvZnMvY2dyb3VwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJyZWxhdGltZSIsCiAgICAgICAgICAgICAgICAgICI0IjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogImNncm91cCIsCiAgICAgICAgICAgICAgInR5cGUiOiAiY2dyb3VwIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDIKICAgICAgICB9LAogICAgICAgICJ3b3JraW5nX2RpciI6ICIvcm9vdC8iCiAgICAgIH0sCiAgICAgICI1IjogewogICAgICAgICJhbGxvd19lbGV2YXRlZCI6IGZhbHNlLAogICAgICAgICJjb21tYW5kIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICJiYXNoIiwKICAgICAgICAgICAgIjEiOiAiL2NvcHlfcmVzb2x2X2NvbmYuc2giCiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDIKICAgICAgICB9LAogICAgICAgICJlbnZfcnVsZXMiOiB7CiAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICIwIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX0FQSV9WRVJTSU9OPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9IRUFERVI9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfQ29kZVBhY2thZ2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX1NlcnZpY2VEbnNOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTIiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiU09VUkNFX1JFU09MVl9DT05GX0xPQ0FUSU9OPS9ldGMvcmVzb2x2LmNvbmYiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJERVNUSU5BVElPTl9SRVNPTFZfQ09ORl9MT0NBVElPTj0vbW91bnQvcmVzb2x2Y29uZi9yZXNvbHYuY29uZiIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjE0IjogewogICAgICAgICAgICAgICJydWxlIjogImF6dXJlY29udGFpbmVyaW5zdGFuY2VfcmVzdGFydGVkX2J5PS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9TRVJWRVJfVEhVTUJQUklOVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjMiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSE9TVE5BTUU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI0IjogewogICAgICAgICAgICAgICJydWxlIjogIlRFUk09eHRlcm0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI1IjogewogICAgICAgICAgICAgICJydWxlIjogIlBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICIoKD9pKUZBQlJJQylfLis9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI3IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY19JZD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljX1NlcnZpY2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNfQXBwbGljYXRpb25OYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDE1CiAgICAgICAgfSwKICAgICAgICAibGF5ZXJzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICI2MDZmZDZiYWY1ZWIxYTcxZmQyODZhZWEyOTY3MmEwNmJmZTU1ZjAwMDdkZWQ5MmVlNzMxNDJhMzc1OTBlZDE5IiwKICAgICAgICAgICAgIjEiOiAiOTdhZGZkYTY5NDNmM2FmOTcyYjliZjRmYTY4NGY1MzNmMTBjMDIzZDkxM2QxOTUwNDhmZWYwM2Y5YzNjNjBmZCIsCiAgICAgICAgICAgICIyIjogIjI5NmU1YmFhNWI5ZGVkODYzY2EwMTcwZTA1Y2Q5ZWNmNDEzNmY4NmM4MzBhOWRhOTA2MTg0YWIxNDc0MTVjN2IiLAogICAgICAgICAgICAiMyI6ICJhNmE2OTE4YzA3Yzg1ZTI5ZTQ4ZDRhODdjMTE5NDc4MTI1MWQ1MTg1ZjY4MmMyNmYyMGQ2ZWU0ZTk1NWEyMzlmIiwKICAgICAgICAgICAgIjQiOiAiMjg1Y2I2ODBhNTVkMDlmNTQ4ZDRiYWE4MDRhNjYzNzY0Nzg4NjE5ODI0NTY1Njg1YjMyYjgwOTdjYmVkM2QyNiIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogNQogICAgICAgIH0sCiAgICAgICAgIm1vdW50cyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInN5c2ZzIiwKICAgICAgICAgICAgICAidHlwZSI6ICJzeXNmcyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMvZnMvY2dyb3VwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJyZWxhdGltZSIsCiAgICAgICAgICAgICAgICAgICI0IjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogImNncm91cCIsCiAgICAgICAgICAgICAgInR5cGUiOiAiY2dyb3VwIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL21vdW50L3Jlc29sdmNvbmYiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJyYmluZCIsCiAgICAgICAgICAgICAgICAgICIxIjogInJzaGFyZWQiLAogICAgICAgICAgICAgICAgICAiMiI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJzYW5kYm94Oi8vL3RtcC9hdGxhcy9yZXNvbHZjb25mLy4rIiwKICAgICAgICAgICAgICAidHlwZSI6ICJiaW5kIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDMKICAgICAgICB9LAogICAgICAgICJ3b3JraW5nX2RpciI6ICIvIgogICAgICB9LAogICAgICAiNiI6IHsKICAgICAgICAiYWxsb3dfZWxldmF0ZWQiOiB0cnVlLAogICAgICAgICJjb21tYW5kIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICIvc2tyLnNoIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAxCiAgICAgICAgfSwKICAgICAgICAiZW52X3J1bGVzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJTa3JTaWRlQ2FyQXJncz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiUEFUSD0vdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46L3Vzci9zYmluOi91c3IvYmluOi9zYmluOi9iaW4iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9TRVJWRVJfVEhVTUJQUklOVD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjExIjogewogICAgICAgICAgICAgICJydWxlIjogImF6dXJlY29udGFpbmVyaW5zdGFuY2VfcmVzdGFydGVkX2J5PS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJURVJNPXh0ZXJtIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICIoKD9pKUZBQlJJQylfLis9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI0IjogewogICAgICAgICAgICAgICJydWxlIjogIkhPU1ROQU1FPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJUKEUpP01QPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNiI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJGYWJyaWNQYWNrYWdlRmlsZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI3IjogewogICAgICAgICAgICAgICJydWxlIjogIkhvc3RlZFNlcnZpY2VOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9BUElfVkVSU0lPTj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjkiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfSEVBREVSPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDEyCiAgICAgICAgfSwKICAgICAgICAibGF5ZXJzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICI4NThjYzI5OWYyZWM5MzY5OTU5YmI1NGI3N2E2MjIyZTMyZTc0MDczYjA0MTUxZmYyYWZiZTlkMmViMTRjY2U2IiwKICAgICAgICAgICAgIjEiOiAiNzU2ZmY1YzdiYTAzZmZlOWNhNzUxODZhYTM4ZmMwNjgwOWU5MjUwNmJkMTEyNzc5ZmM2YjZiMGQxNjJmNjJmNCIsCiAgICAgICAgICAgICIyIjogIjUyOGViNjFlN2M5ZjYzN2E4MzkxZmVmYzA4M2FlMDEyZGZkZTk4NGJlYzEyNjNiNDc0OThmMTZmYTA5ZjE5YTQiLAogICAgICAgICAgICAiMyI6ICIyYjg0MTNjNGFiMjE1NTFmMmU1NWRlNzA0NDBhMjUxNzVkMjg2YjdlYzk2NjhhMzEwN2I3MmZhODU5MDU3NDczIiwKICAgICAgICAgICAgIjQiOiAiNjNjNDg2YjcyYjZlYzZhMjkyYmYzODM1NmNlNjYzMzU5Yzk1NWNmOWUxYzI2ZmMzNzJmOWQ5MmRlMTBiMjVjYiIsCiAgICAgICAgICAgICI1IjogIjBhN2Y1MjdhZmQxZDJlODBjZWM2NzI2NDI5ODQyNTYxNjgyMDhmOGZhZWQ4MWRjMjhhMDc5Y2MzODIwMzYzZmMiCiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDYKICAgICAgICB9LAogICAgICAgICJtb3VudHMiOiB7CiAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICIwIjogewogICAgICAgICAgICAgICJkZXN0aW5hdGlvbiI6ICIvc3lzIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogNAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJzeXNmcyIsCiAgICAgICAgICAgICAgInR5cGUiOiAic3lzZnMiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxIjogewogICAgICAgICAgICAgICJkZXN0aW5hdGlvbiI6ICIvc3lzL2ZzL2Nncm91cCIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogIm5vc3VpZCIsCiAgICAgICAgICAgICAgICAgICIxIjogIm5vZXhlYyIsCiAgICAgICAgICAgICAgICAgICIyIjogIm5vZGV2IiwKICAgICAgICAgICAgICAgICAgIjMiOiAicmVsYXRpbWUiLAogICAgICAgICAgICAgICAgICAiNCI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogNQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJjZ3JvdXAiLAogICAgICAgICAgICAgICJ0eXBlIjogImNncm91cCIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjIiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9ldGMvcmVzb2x2LmNvbmYiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJyYmluZCIsCiAgICAgICAgICAgICAgICAgICIxIjogInJzaGFyZWQiLAogICAgICAgICAgICAgICAgICAiMiI6ICJydyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgInNvdXJjZSI6ICJzYW5kYm94Oi8vL3RtcC9hdGxhcy9yZXNvbHZjb25mLy4rIiwKICAgICAgICAgICAgICAidHlwZSI6ICJiaW5kIgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDMKICAgICAgICB9LAogICAgICAgICJ3b3JraW5nX2RpciI6ICIvIgogICAgICB9LAogICAgICAiNyI6IHsKICAgICAgICAiYWxsb3dfZWxldmF0ZWQiOiBmYWxzZSwKICAgICAgICAiY29tbWFuZCI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiL3Rlc3RzL3Nrcl9jbGllbnQuc2giCiAgICAgICAgICB9LAogICAgICAgICAgImxlbmd0aCI6IDEKICAgICAgICB9LAogICAgICAgICJlbnZfcnVsZXMiOiB7CiAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICIwIjogewogICAgICAgICAgICAgICJydWxlIjogIigoP2kpU2tyQ2xpZW50KS4rPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJQQVRIPS91c3IvbG9jYWwvc2JpbjovdXNyL2xvY2FsL2JpbjovdXNyL3NiaW46L3Vzci9iaW46L3NiaW46L2JpbiIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEwIjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX1NFUlZFUl9USFVNQlBSSU5UPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTEiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiYXp1cmVjb250YWluZXJpbnN0YW5jZV9yZXN0YXJ0ZWRfYnk9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJydWxlIjogIlRFUk09eHRlcm0iLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJzdHJpbmciCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIzIjogewogICAgICAgICAgICAgICJydWxlIjogIigoP2kpRkFCUklDKV8uKz0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjQiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSE9TVE5BTUU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI1IjogewogICAgICAgICAgICAgICJydWxlIjogIlQoRSk/TVA9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI2IjogewogICAgICAgICAgICAgICJydWxlIjogIkZhYnJpY1BhY2thZ2VGaWxlTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjciOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSG9zdGVkU2VydmljZU5hbWU9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI4IjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX0FQSV9WRVJTSU9OPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiOSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJJREVOVElUWV9IRUFERVI9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMTIKICAgICAgICB9LAogICAgICAgICJsYXllcnMiOiB7CiAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICIwIjogIjg1OGNjMjk5ZjJlYzkzNjk5NTliYjU0Yjc3YTYyMjJlMzJlNzQwNzNiMDQxNTFmZjJhZmJlOWQyZWIxNGNjZTYiLAogICAgICAgICAgICAiMSI6ICI3NTZmZjVjN2JhMDNmZmU5Y2E3NTE4NmFhMzhmYzA2ODA5ZTkyNTA2YmQxMTI3NzlmYzZiNmIwZDE2MmY2MmY0IiwKICAgICAgICAgICAgIjIiOiAiNTI4ZWI2MWU3YzlmNjM3YTgzOTFmZWZjMDgzYWUwMTJkZmRlOTg0YmVjMTI2M2I0NzQ5OGYxNmZhMDlmMTlhNCIsCiAgICAgICAgICAgICIzIjogIjJiODQxM2M0YWIyMTU1MWYyZTU1ZGU3MDQ0MGEyNTE3NWQyODZiN2VjOTY2OGEzMTA3YjcyZmE4NTkwNTc0NzMiLAogICAgICAgICAgICAiNCI6ICI2M2M0ODZiNzJiNmVjNmEyOTJiZjM4MzU2Y2U2NjMzNTljOTU1Y2Y5ZTFjMjZmYzM3MmY5ZDkyZGUxMGIyNWNiIiwKICAgICAgICAgICAgIjUiOiAiMGE3ZjUyN2FmZDFkMmU4MGNlYzY3MjY0Mjk4NDI1NjE2ODIwOGY4ZmFlZDgxZGMyOGEwNzljYzM4MjAzNjNmYyIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogNgogICAgICAgIH0sCiAgICAgICAgIm1vdW50cyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA0CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInN5c2ZzIiwKICAgICAgICAgICAgICAidHlwZSI6ICJzeXNmcyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjEiOiB7CiAgICAgICAgICAgICAgImRlc3RpbmF0aW9uIjogIi9zeXMvZnMvY2dyb3VwIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAibm9zdWlkIiwKICAgICAgICAgICAgICAgICAgIjEiOiAibm9leGVjIiwKICAgICAgICAgICAgICAgICAgIjIiOiAibm9kZXYiLAogICAgICAgICAgICAgICAgICAiMyI6ICJyZWxhdGltZSIsCiAgICAgICAgICAgICAgICAgICI0IjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiA1CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogImNncm91cCIsCiAgICAgICAgICAgICAgInR5cGUiOiAiY2dyb3VwIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMiI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL2V0Yy9yZXNvbHYuY29uZiIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogInJiaW5kIiwKICAgICAgICAgICAgICAgICAgIjEiOiAicnNoYXJlZCIsCiAgICAgICAgICAgICAgICAgICIyIjogInJ3IgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAic291cmNlIjogInNhbmRib3g6Ly8vdG1wL2F0bGFzL3Jlc29sdmNvbmYvLisiLAogICAgICAgICAgICAgICJ0eXBlIjogImJpbmQiCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMwogICAgICAgIH0sCiAgICAgICAgIndvcmtpbmdfZGlyIjogIi8iCiAgICAgIH0sCiAgICAgICI4IjogewogICAgICAgICJhbGxvd19lbGV2YXRlZCI6IGZhbHNlLAogICAgICAgICJjb21tYW5kIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6ICIvdGVzdHMvYXR0ZXN0X2NsaWVudC5zaCIKICAgICAgICAgIH0sCiAgICAgICAgICAibGVuZ3RoIjogMQogICAgICAgIH0sCiAgICAgICAgImVudl9ydWxlcyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiKCg/aSlBdHRlc3RDbGllbnQpLis9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxIjogewogICAgICAgICAgICAgICJydWxlIjogIlBBVEg9L3Vzci9sb2NhbC9zYmluOi91c3IvbG9jYWwvYmluOi91c3Ivc2JpbjovdXNyL2Jpbjovc2JpbjovYmluIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAic3RyaW5nIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMTAiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfU0VSVkVSX1RIVU1CUFJJTlQ9LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIxMSI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJhenVyZWNvbnRhaW5lcmluc3RhbmNlX3Jlc3RhcnRlZF9ieT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjIiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiVEVSTT14dGVybSIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInN0cmluZyIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjMiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiKCg/aSlGQUJSSUMpXy4rPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNCI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIT1NUTkFNRT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjUiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiVChFKT9NUD0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjYiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiRmFicmljUGFja2FnZUZpbGVOYW1lPS4rIiwKICAgICAgICAgICAgICAic3RyYXRlZ3kiOiAicmUyIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiNyI6IHsKICAgICAgICAgICAgICAicnVsZSI6ICJIb3N0ZWRTZXJ2aWNlTmFtZT0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfSwKICAgICAgICAgICAgIjgiOiB7CiAgICAgICAgICAgICAgInJ1bGUiOiAiSURFTlRJVFlfQVBJX1ZFUlNJT049LisiLAogICAgICAgICAgICAgICJzdHJhdGVneSI6ICJyZTIiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICI5IjogewogICAgICAgICAgICAgICJydWxlIjogIklERU5USVRZX0hFQURFUj0uKyIsCiAgICAgICAgICAgICAgInN0cmF0ZWd5IjogInJlMiIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAxMgogICAgICAgIH0sCiAgICAgICAgImxheWVycyI6IHsKICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgIjAiOiAiODU4Y2MyOTlmMmVjOTM2OTk1OWJiNTRiNzdhNjIyMmUzMmU3NDA3M2IwNDE1MWZmMmFmYmU5ZDJlYjE0Y2NlNiIsCiAgICAgICAgICAgICIxIjogIjc1NmZmNWM3YmEwM2ZmZTljYTc1MTg2YWEzOGZjMDY4MDllOTI1MDZiZDExMjc3OWZjNmI2YjBkMTYyZjYyZjQiLAogICAgICAgICAgICAiMiI6ICI1MjhlYjYxZTdjOWY2MzdhODM5MWZlZmMwODNhZTAxMmRmZGU5ODRiZWMxMjYzYjQ3NDk4ZjE2ZmEwOWYxOWE0IiwKICAgICAgICAgICAgIjMiOiAiMmI4NDEzYzRhYjIxNTUxZjJlNTVkZTcwNDQwYTI1MTc1ZDI4NmI3ZWM5NjY4YTMxMDdiNzJmYTg1OTA1NzQ3MyIsCiAgICAgICAgICAgICI0IjogIjYzYzQ4NmI3MmI2ZWM2YTI5MmJmMzgzNTZjZTY2MzM1OWM5NTVjZjllMWMyNmZjMzcyZjlkOTJkZTEwYjI1Y2IiLAogICAgICAgICAgICAiNSI6ICIwYTdmNTI3YWZkMWQyZTgwY2VjNjcyNjQyOTg0MjU2MTY4MjA4ZjhmYWVkODFkYzI4YTA3OWNjMzgyMDM2M2ZjIgogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiA2CiAgICAgICAgfSwKICAgICAgICAibW91bnRzIjogewogICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAiMCI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cyIsCiAgICAgICAgICAgICAgIm9wdGlvbnMiOiB7CiAgICAgICAgICAgICAgICAiZWxlbWVudHMiOiB7CiAgICAgICAgICAgICAgICAgICIwIjogIm5vc3VpZCIsCiAgICAgICAgICAgICAgICAgICIxIjogIm5vZXhlYyIsCiAgICAgICAgICAgICAgICAgICIyIjogIm5vZGV2IiwKICAgICAgICAgICAgICAgICAgIjMiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAic3lzZnMiLAogICAgICAgICAgICAgICJ0eXBlIjogInN5c2ZzIgogICAgICAgICAgICB9LAogICAgICAgICAgICAiMSI6IHsKICAgICAgICAgICAgICAiZGVzdGluYXRpb24iOiAiL3N5cy9mcy9jZ3JvdXAiLAogICAgICAgICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAgICAgImVsZW1lbnRzIjogewogICAgICAgICAgICAgICAgICAiMCI6ICJub3N1aWQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJub2V4ZWMiLAogICAgICAgICAgICAgICAgICAiMiI6ICJub2RldiIsCiAgICAgICAgICAgICAgICAgICIzIjogInJlbGF0aW1lIiwKICAgICAgICAgICAgICAgICAgIjQiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAiY2dyb3VwIiwKICAgICAgICAgICAgICAidHlwZSI6ICJjZ3JvdXAiCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICIyIjogewogICAgICAgICAgICAgICJkZXN0aW5hdGlvbiI6ICIvZXRjL3Jlc29sdi5jb25mIiwKICAgICAgICAgICAgICAib3B0aW9ucyI6IHsKICAgICAgICAgICAgICAgICJlbGVtZW50cyI6IHsKICAgICAgICAgICAgICAgICAgIjAiOiAicmJpbmQiLAogICAgICAgICAgICAgICAgICAiMSI6ICJyc2hhcmVkIiwKICAgICAgICAgICAgICAgICAgIjIiOiAicnciCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImxlbmd0aCI6IDMKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICJzb3VyY2UiOiAic2FuZGJveDovLy90bXAvYXRsYXMvcmVzb2x2Y29uZi8uKyIsCiAgICAgICAgICAgICAgInR5cGUiOiAiYmluZCIKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgICJsZW5ndGgiOiAzCiAgICAgICAgfSwKICAgICAgICAid29ya2luZ19kaXIiOiAiLyIKICAgICAgfQogICAgfSwKICAgICJsZW5ndGgiOiA5CiAgfQp9")

	if err != nil {
		t.Fatal("decoding policy base64 failed")
	}

	InvalidCertChain := make([]byte, len(ValidCertChain))
	copy(InvalidCertChain, ValidCertChain)
	// modify one byte
	InvalidCertChain[len(InvalidCertChain)/2] = 0x00

	CorruptedProductionSNPReportBytes, _ := hex.DecodeString("00000000020000001f0003000000000001000000000000000000000000000000020000000000000000000000000000000000000001000000020000000000065d010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000deac3d39f12ba5f45e4bdd7a3686134c0b7b6883381210a87d6b8015e60a6bad5b264d5c2725e6b6ef8b9e3f376160b4dff51dbeac6096960223d54e5bee6a7df6a131c109b34d8043da5874d56bb78d70eed5b3693ebb29d964f7ae295f49cb0554b4cc33ced533c7a6f9aeb4c563c68bece465756389dfa5f527bcb65c74ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e29a02183df412e5c69c3d7b0beedfc8eff96bc16c0020b1cd06d9718ae37d9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff020000000000065d0000000000000000000000000000000000000000000000005c6095e0748b55eaca503f2a020ade6a9151d6a62a292c6c7af3c935e3a3f8f401770cd189b7f666141930e3461573301a635e7fb0898de062241ea0da9a85d3020000000000065d0133010001330100020000000000065d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008961c43fca3e22bb3e4ecd99e70bc1027fe43b32cc955077528c02249de74e1ececc6bbb91a6e2899fec6c54fab5653700000000000000000000000000000000000000000000000089c9797445d305380c5595ccc2f4e61b2c1fe5596b9ed5dc842c3d0dece0bf9aab9fc0d7c34e1315d5e143bb374303a30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")

	CorruptedProductionSigSNPReportBytes, _ := hex.DecodeString("02000000020000001f0003000000000001000000000000000000000000000000020000000000000000000000000000000000000001000000020000000000065d010000000000000000000000000000007ab000a323b3c873f5b81bbe584e7c1a26bcf40dc27e00f8e0d144b1ed2d14f10000000000000000000000000000000000000000000000000000000000000000deac3d39f12ba5f45e4bdd7a3686134c0b7b6883381210a87d6b8015e60a6bad5b264d5c2725e6b6ef8b9e3f376160b4dff51dbeac6096960223d54e5bee6a7df6a131c109b34d8043da5874d56bb78d70eed5b3693ebb29d964f7ae295f49cb0554b4cc33ced533c7a6f9aeb4c563c68bece465756389dfa5f527bcb65c74ea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e29a02183df412e5c69c3d7b0beedfc8eff96bc16c0020b1cd06d9718ae37d9ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff020000000000065d0000000000000000000000000000000000000000000000005c6095e0748b55eaca503f2a020ade6a9151d6a62a292c6c7af3c935e3a3f8f401770cd189b7f666141930e3461573301a635e7fb0898de062241ea0da9a85d3020000000000065d0133010001330100020000000000065d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008961c43fca3e22bb3e4ecd99e70bc1027fe43b32cc955077528c02249de74e1ececc6bbb91a6e2899fec6c54fab5653700000000000000000000000000000000000000000000000089c9797445d305380c5595ccc2f4e61b2c1fe5596b9ed5dc842c3d0dece0bf9aab9fc0d7c34e1315d5e143bb374303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")

	type testcase struct {
		name string

		maa MAA

		snpAttestationReport []byte
		vcekCertChain        []byte
		policyBlob           []byte
		keyBlob              []byte

		expectedError error
		expectErr     bool
	}

	testcases := []*testcase{
		// MAA_Success passes testing if the error is nil
		{
			name: "MAA_Success",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           TestSNPPolicyBlobBytes,
			keyBlob:              TestKeyBlobBytes,

			expectedError: nil,
			expectErr:     false,
		},
		{
			name: "MAA_Success_Production",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: ProductionTestSNPReportBytes,
			vcekCertChain:        ProductionValidCertChain,
			policyBlob:           ProductionTestSNPPolicyBlobBytes,
			keyBlob:              ProductionTestKeyBlobBytes,

			expectedError: nil,
			expectErr:     false,
		},
		// MAA_InvalidCertChain testing passes if the MAA responds with Bad Request
		{
			name: "MAA_InvalidCertChain",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        InvalidCertChain,
			policyBlob:           TestSNPPolicyBlobBytes,
			keyBlob:              TestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		// MAA_InvalidKeyBlob testing passes if the MAA responds with Bad Request as the key blob does not match the one in the attestation report
		{
			name: "MAA_InvalidKeyBlob",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           TestSNPPolicyBlobBytes,
			keyBlob:              make([]byte, 4),

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		// MAA_TamperedKeyBlob testing passes if the MAA responds with Bad Request as the key blob does not match the one in the attestation report
		{
			name: "MAA_TamperedKeyBlob",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           TestSNPPolicyBlobBytes,
			keyBlob:              TestKeyBlobBytesTampered,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		// MAA_InvalidPolicyBlob testing passes if the MAA responds with Bad Request as the policy does not match the one in the attestation report
		{
			name: "MAA_InvalidPolicyBlob",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           make([]byte, 4),
			keyBlob:              TestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		// MAA_TamperedPolicyBlob testing passes if the MAA responds with Bad Request as the policy does not match the one in the attestation report
		{
			name: "MAA_TamperedPolicyBlob",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: TestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           TestSNPPolicyBlobBytesTampered,
			keyBlob:              TestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		{
			name: "MAA_CorruptedSNPReport",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: CorruptedProductionSNPReportBytes,
			vcekCertChain:        ProductionValidCertChain,
			policyBlob:           ProductionTestSNPPolicyBlobBytes,
			keyBlob:              ProductionTestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		{
			name: "MAA_CorruptedSigSNPReport",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: CorruptedProductionSigSNPReportBytes,
			vcekCertChain:        ProductionValidCertChain,
			policyBlob:           ProductionTestSNPPolicyBlobBytes,
			keyBlob:              ProductionTestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
		{
			name: "MAA_NotMatchingCertChain",

			maa: MAA{
				Endpoint:   ValidMAAEndpoint,
				TEEType:    ValidTEEType,
				APIVersion: ValidMAAAPIVersion,
			},

			snpAttestationReport: ProductionTestSNPReportBytes,
			vcekCertChain:        ValidCertChain,
			policyBlob:           ProductionTestSNPPolicyBlobBytes,
			keyBlob:              ProductionTestKeyBlobBytes,

			expectedError: errors.New("pulling maa post response failed: http response status equal to 400 Bad Request"),
			expectErr:     true,
		},
	}

	for _, tc := range testcases {
		t.Run(tc.name, func(t *testing.T) {
			resp, err := tc.maa.attest(tc.snpAttestationReport, tc.vcekCertChain, tc.policyBlob, tc.keyBlob)

			if tc.expectErr && err == nil {
				fmt.Printf("token: %v\n", resp)
				t.Fatal("expected err got nil")
			} else if tc.expectErr && err.Error() != tc.expectedError.Error() {
				t.Fatalf("expected %q got %q", tc.expectedError.Error(), err.Error())
			} else if !tc.expectErr && err != nil {
				t.Fatalf("did not expect err got %q", err.Error())
			}
		})
	}
}
